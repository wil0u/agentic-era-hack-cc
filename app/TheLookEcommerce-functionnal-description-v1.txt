This document is a description of the database The Look e-commerce.
There are 3 sections : overview, tables description and examples of query related to a business marketing question.

----------------------------------------------
Section 1 : Overview of the database TheLook e-commerce:
----------------------------------------------

TheLook is a fictitious e-commerce clothing site.
TheLook e-commerce database contains information about customers, products, orders, web events.
In this sample, the database has been restricted to 5 tables: ‘events’, ‘order_items’, ‘orders’, ‘products’ and ‘users’.
In marketing Campaign use cases, the core table is the 'users' where each row describe a Customer, the 'id' field represents the user id or Customer id. There are 100 000 users in the users table.

----------------------------------------------
Section 2 : Description of the tables of the database TheLook e-commerce:
----------------------------------------------

'users' : the customers of the e-commerce TheLook. For marketing tasks, all counts must be based on this table given that the total of distincts users is 100 000. filters on information on customers must be filtered or joined by using the fields of the 'users' table like the key fields : country, age, gender, traffic source.

'orders' orders corresponding to transactions of the customers / users during their navigation. A row in this table is an order . Each order have a status 'shipped', 'cancelled' or 'returned'. The column orders.num_of_item is the number of items ordered.

'order_item' : product items ordered in an order id, the table order_items contains each item ordered for an order_id. The column order_items.product_id is the product ordered.

'products' : reference table of all the products of the e-commerce clothing site, there are 29 120 distincts products. 
The key columns to describe a product are : 
- the 'category' which is the category of clothes like 'dresses', 'swim'.
- the 'brand' of the product, note that brands are fictitious
- the 'retail price'
- the 'department' which is 'Women' or 'Men'

'events' : navigation on the web site by the users, each row is a page visited, the session id helps to understand how the user navigate, the sequence number is the order of the pages within a session id. the event type is a key field with  6 distinct values : home (means the visit homepage), department (means the visit of a category page), product (means the visit of a product page), cart (means that the user add an items to the basket), purchase (means that the user purchased the basket), cancel (means that the user Don't buy). the uri field described the url, typical examples are a visit of a product page like '/product/id' or a category page like '/department/women/category/sweaters/brand/kirra'


----------------------------------------------
Section 3 : Examples of marketing Questions and Answers of the database TheLook e-commerce:
----------------------------------------------

---------
Beginning of Example 1 : 
business question : Who are our customers? Which country do we have major customers coming from? 
Steps: Use a with query named customers to get the distinct user id, country, and the total number of users or customers who were male or female. Then, SELECT the country, count of distinct customer ids, and count of customers who were male or female.

query answer :
WITH customers AS (
  SELECT
    DISTINCT oi.user_id,
    SUM(CASE WHEN u.gender = 'M' THEN 1 ELSE null END) AS male,
    SUM(CASE WHEN u.gender = 'F' THEN 1 ELSE null END) AS female,
    u.country AS country
    FROM bigquery-public-data.thelook_ecommerce.order_items AS oi
    INNER JOIN bigquery-public-data.thelook_ecommerce.users AS u
    ON oi.user_id = u.id
    WHERE oi.status not in ('Cancelled', 'Returned')
    GROUP BY user_id, country
    )

SELECT
  country,
  COUNT(DISTINCT user_id) AS customers_count,
  COUNT(female) AS female,
  COUNT(male) AS male
FROM customers
GROUP BY country
ORDER BY customers_count DESC;

End of Example 1
---------
Beginning of example 2
business question :  What product category are we selling more and the least? What are we making money on?
Steps: Select the product category, and calculate the sum of the revenue and quantity of products generated by each brand.

query answer :
SELECT
  category AS product_category,
  ROUND(SUM(sale_price * num_of_item), 2) AS revenue,
  SUM(num_of_item) AS quantity
FROM bigquery-public-data.thelook_ecommerce.order_items oi
INNER JOIN bigquery-public-data.thelook_ecommerce.orders o
ON oi.order_id = o.order_id
INNER JOIN bigquery-public-data.thelook_ecommerce.products p
ON oi.product_id = p.id
WHERE oi.status NOT IN ('cancelled', 'Returned')
GROUP BY category
ORDER BY revenue DESC;

End of Example 2
---------
Beginning of example 3

business question : What marketing channel are we doing well on?
Steps: Select the traffic source and count the total number of customers that made purchases via each traffic source.

query answer :
SELECT 
  u.traffic_source AS traffic_source,
  COUNT(DISTINCT oi.user_id) AS total_customers
FROM bigquery-public-data.thelook_ecommerce.order_items oi
INNER JOIN bigquery-public-data.thelook_ecommerce.users u
ON oi.user_id = u.id
WHERE oi.status NOT IN ('Cancelled', 'Returned')
GROUP BY traffic_source
ORDER BY total_customers DESC;

End of Example 3
---------
Beginning of example 4

business question : We will provide promotions during Chinese New Year celebrations for female customers in China via email.
Steps: Select the id, email of the customers
query answer :
Use the WHERE clause to filter the data for females living in China

SELECT 
  id,
  email
FROM `bigquery-public-data.thelook_ecommerce.users` 
WHERE gender = 'F' AND country = 'China'
ORDER BY id;

Example 5
business question : Provide a list of 10 customer ids and emails with the largest total overall purchase. We will give a discount for campaign 3.3!
Steps: Select the customer Id and email. Use the Sum function to calculate the total purchase value for each customer. Use the Limit function to limit the result to only the top 10 high-value customers.

query answer:
SELECT
  u.id AS customer_id,
  u.email AS  email,
  ROUND(SUM(oi.sale_price * o.num_of_item), 2) AS total_purchase
FROM bigquery-public-data.thelook_ecommerce.order_items AS oi
INNER JOIN bigquery-public-data.thelook_ecommerce.orders AS o
ON oi.order_id = o.order_id
INNER JOIN bigquery-public-data.thelook_ecommerce.users AS u
ON o.user_id = u.id
GROUP BY customer_id, email
ORDER BY total_purchase DESC
LIMIT 10;

End of Example 4
---------